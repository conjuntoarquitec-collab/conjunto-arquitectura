<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conjunto | Selecciona tu paquete</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#121a24;
      --stroke:#203044;
      --stroke2:#2a415b;
      --txt:#eaf0ff;
      --muted:#9fb6d6;
      --blue:#2b7cff;
    }
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--txt)}
    .wrap{max-width:980px;margin:auto;padding:40px 18px}
    .panel{background:var(--card);border:1px solid var(--stroke);border-radius:22px;padding:28px}
    h1{margin:0 0 6px;font-size:34px}
    p{margin:0 0 18px;color:var(--muted);line-height:1.55}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:780px){ .grid{grid-template-columns:1fr;} }

    a.pkg{
      display:block;text-decoration:none;color:inherit;
      background:rgba(10,14,20,.35);
      border:1px solid rgba(42,65,91,.55);
      border-radius:18px;
      padding:18px;
      position:relative;
      transition:transform .12s ease, filter .15s ease, border-color .15s ease, background .15s ease;
    }
    a.pkg:hover{
      filter:brightness(1.08);
      border-color: rgba(43,124,255,.55);
      background: rgba(28,42,58,.55);
      transform: translateY(-1px);
    }

    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#1b2635;border:1px solid var(--stroke2);font-size:12px;color:var(--txt)}
    .title{margin:10px 0 6px;font-size:22px;font-weight:900}
    .desc{margin:0;color:var(--muted);font-size:13px}
    .cta{margin-top:14px;display:inline-block;background:var(--blue);color:#08121f;font-weight:900;padding:10px 14px;border-radius:12px}

    .foot{
      margin-top:16px;color:var(--muted);font-size:12px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center
    }
    .dot{opacity:.7}
    .vis{font-variant-numeric:tabular-nums}
    .badgeCount img{height:18px;vertical-align:middle;opacity:.95}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <span class="badge">Revit 2023/2024/2025/2026 ‚Ä¢ Windows</span>
      <h1>Conjunto</h1>
      <p>Elige qu√© paquete quieres abrir. (Dos puertas: una te da arquitectura‚Ä¶ la otra tambi√©n, pero con fierros üòÑ)</p>

      <div class="grid">
        <a class="pkg" href="./arquitectura.html">
          <div class="title">1) Conjunto Arquitectura</div>
          <p class="desc">Acabados, metrados, renombrados, exportaci√≥n, encofrados, etc.</p>
          <span class="cta">Abrir</span>
        </a>

        <a class="pkg" href="./estructura.html">
          <div class="title">2) Conjunto Estructura</div>
          <p class="desc">Aceros, estribos, zapatas, vigas/columnas, y todo el arsenal estructural.</p>
          <span class="cta">Abrir</span>
        </a>
      </div>

      <div class="foot">
        <span>¬© <span id="y"></span> Conjunto</span>
        <span class="dot">‚Ä¢</span>

        <!-- Modo 1: n√∫mero "peladito" (CountAPI) -->
        <span class="vis" id="visWrap">Visitas: <b id="visitas">‚Äî</b></span>

        <!-- Modo 2 (fallback): badge-imagen si el API est√° bloqueado -->
        <span class="badgeCount" id="badgeWrap" style="display:none">
          Visitas:
          <img id="badgeImg" alt="contador de visitas" />
        </span>
      </div>
    </div>
  </div>

  <script>
    // A√±o
    document.getElementById("y").textContent = new Date().getFullYear();

    // ===== CONTADOR GLOBAL =====
    // GitHub Pages es est√°tico => necesitamos un servicio externo.

    // 1) Identificador √∫nico (ponle algo tuyo para que nadie choque contigo):
    const NAMESPACE = "conjuntoarquitec";     // c√°mbialo si quieres (sin espacios)
    const KEY       = "index-visitas";       // nombre del contador

    const elNum = document.getElementById("visitas");
    const visWrap = document.getElementById("visWrap");
    const badgeWrap = document.getElementById("badgeWrap");
    const badgeImg = document.getElementById("badgeImg");

    // Si quieres que sume SIEMPRE cada refresh, ponlo en true.
    // Si quieres evitar que el mismo usuario sume mil veces, d√©jalo en false (1 vez/d√≠a por navegador).
    const COUNT_EVERY_LOAD = false;

    const today = new Date().toISOString().slice(0,10); // YYYY-MM-DD
    const localFlag = `counted:${NAMESPACE}:${KEY}:${today}`;

    function toNumber(v){
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    async function fetchJSON(url){
      const r = await fetch(url, { cache: "no-store" });
      if(!r.ok) throw new Error("HTTP " + r.status);
      return await r.json();
    }

    async function countapiGet(){
      const data = await fetchJSON(`https://api.countapi.xyz/get/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(KEY)}`);
      const n = data ? toNumber(data.value) : null;
      return n;
    }

    async function countapiHit(){
      const data = await fetchJSON(`https://api.countapi.xyz/hit/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(KEY)}`);
      const n = data ? toNumber(data.value) : null;
      return n;
    }

    async function countapiCreateIfNeeded(){
      // Por si el API exige ‚Äúcrear‚Äù primero en algunos casos
      try{
        await fetchJSON(`https://api.countapi.xyz/create?namespace=${encodeURIComponent(NAMESPACE)}&key=${encodeURIComponent(KEY)}&value=0`);
      }catch(e){
        // si falla, no pasa nada: igual intentamos hit/get
      }
    }

    function showBadgeFallback(){
      // Fallback: contador como imagen (suele pasar bloqueos de CORS/AdBlock mejor que fetch)
      // Nota: esto cuenta por "path". Cambia el path si quieres separar contadores.
      const pagePath = "conjunto-arquitectura/index";
      badgeImg.src = `https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=${encodeURIComponent(location.href)}&count_bg=%232B7CFF&title_bg=%23121A24&icon=&icon_color=%23E7E7E7&title=visitas&edge_flat=false`;
      visWrap.style.display = "none";
      badgeWrap.style.display = "inline-block";
    }

    async function updateCounter(){
      try{
        // Si queremos evitar que el mismo navegador sume varias veces hoy:
        if (!COUNT_EVERY_LOAD && localStorage.getItem(localFlag) === "1"){
          // solo leer
          let n = await countapiGet();
          if (n === null) { await countapiCreateIfNeeded(); n = await countapiGet(); }
          elNum.textContent = (n === null) ? "‚Äî" : n;
          return;
        }

        // sumar
        let n = await countapiHit();
        if (n === null) { await countapiCreateIfNeeded(); n = await countapiHit(); }

        if (n !== null){
          elNum.textContent = n;
          if (!COUNT_EVERY_LOAD) localStorage.setItem(localFlag, "1");
        }else{
          // si no pudimos leer el n√∫mero, fallback
          showBadgeFallback();
        }
      }catch(err){
        // Normalmente aqu√≠ cae si AdBlock/Brave bloquea countapi
        console.warn("Contador bloqueado/no disponible:", err);
        showBadgeFallback();
      }
    }

    updateCounter();
  </script>
</body>
</html>
